<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kitchen Light</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font: 16px/1.4 system-ui, sans-serif; margin: 2rem; }
    button { padding: .6rem 1rem; margin-right: .5rem; }
    #log { margin-top: 1rem; padding:.5rem; border:1px solid #ddd; max-height: 220px; overflow-y:auto; }
  </style>
</head>
<body>
  <h1>Kitchen Light</h1>

  <button id="btnOn">ON</button>
  <button id="btnOff">OFF</button>
  <span id="status">status: â€¦</span>

  <div id="log"></div>

  <script>
    const log = (t) => {
      const p = document.createElement('div'); p.textContent = t;
      document.getElementById('log').appendChild(p);
    };

    // >>> Replace with your current ngrok HTTPS host <<<
    const NGROK_HOST = '810ef213316b.ngrok-free.app';

    const client = mqtt.connect({
      protocol: 'wss',
      hostname: NGROK_HOST,
      port: 443,
      path: '/mqtt',              // mosquitto accepts any path; '/mqtt' is common
      connectTimeout: 5000,
    });

    client.on('connect', () => {
      log('âœ… connected');
      client.subscribe('kitchen/light_status');
    });

    client.on('error', (e) => log('âŒ ' + e.message));

    client.on('message', (topic, payload) => {
      const msg = payload.toString();
      log(`ðŸ”” ${topic}: ${msg}`);
      if (topic === 'kitchen/light_status') {
        document.getElementById('status').textContent = 'status: ' + msg;
      }
    });

    document.getElementById('btnOn').onclick  = () => client.publish('kitchen/light', 'ON');
    document.getElementById('btnOff').onclick = () => client.publish('kitchen/light', 'OFF');
  </script>
</body>
</html>
